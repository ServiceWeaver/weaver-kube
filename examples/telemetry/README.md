# Telemetry

This directory contains an example of how to use the `weaver kube` plugin API to
configure how metrics and traces are exported. In `main.go`, we register a
plugin to export traces to [Jaeger][jaeger] and a plugin to export metrics to [Prometheus][prometheus].
Compile the `telemetry` binary and use it as you would `weaver kube`. Use
`prometheus.yaml` and `jaeger.yaml` to deploy Prometheus and Jaeger to a
Kubernetes cluster.

```console
$ kubectl apply -f jaeger.yaml -f prometheus.yaml -f $(telemetry deploy kube_deploy.yaml)
```

If you want to visualize your traces and metrics collected by Jaeger and Prometheus
with [Grafana][grafana], you can deploy Grafana using `grafana.yaml`. Note that
Jaeger and Prometheus are automatically added as data sources in Grafana.
`grafana_dashboard.json` is an example of a Service Weaver dashboard that helps
you visualize the metrics generated by Service Weaver.

```console
$ kubectl apply -f grafana.yaml
```

To open Grafana:
```console
$ kubectl port-forward service/grafana 8081:80
```

In your browser open `localhost:8081`. The default username and password are
`admin`, `admin`.

To open Grafana dashboard, follow the instructions [here][grafana_dashboard].

**Note**: `prometheus.yaml`, `jaeger.yaml`, `grafana.yaml` are examples of how
to quickly start Prometheus, Jaeger and Grafana. For production usage, you may
want to further customize them.

[prometheus]: https://prometheus.io/
[jaeger]: https://www.jaegertracing.io/
[grafana]: https://grafana.com/
[grafana_dashboard]: https://grafana.com/docs/grafana/latest/dashboards/manage-dashboards/#import-a-dashboard